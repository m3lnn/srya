{{ define "header-content" }}
<link rel="stylesheet" href="/css/working.css">
<canvas class="pixel-canvas" id="pixelCanvas"></canvas>

<div class="heading-content" id="mainHeader">
    <div id="content">
        <span class="heading-quote" id="heading">{{ .Site.Params.tagline | default "Finding my place between beauty and practicality" }}</span>
        <p>{{ .Site.Params.subtitle | default "Software Designer | Creative Technologist" }}</p>
    </div>
</div>

{{ end }}

{{ define "main" }}
    <div class="container">
        <h1>{{ .Site.Params.authorName | default "Shaurya singh" }}</h1>
        <p>{{ .Site.Params.currentRole | markdownify }}</p>
        <p>{{ .Site.Params.bio | markdownify }}</p>
    </div>
    
    <div>
        <div class="container">
            <h1>work</h1>
            <p>Collection of recent works, organised by history</p>
        </div>
        
       <div>
    {{ $projects := where .Site.RegularPages "Section" "working" }}
    {{ $projects = sort $projects "Date" "desc" }}

    {{ $yearMap := dict }}
    {{ $years := slice }}

    <!-- Group projects by year -->
    {{ range $projects }}
        {{ $year := .Params.year }}
        {{ if $year }}
            {{ $yearStr := string $year }}
            {{ $existing := index $yearMap $yearStr }}
            {{ if $existing }}
                <!-- Ensure $existing is treated as a slice -->
                {{ $yearMap = merge $yearMap (dict $yearStr ($existing | append .)) }}
            {{ else }}
                {{ $yearMap = merge $yearMap (dict $yearStr (slice .)) }}
                {{ $years = $years | append $year }}
            {{ end }}
        {{ end }}
    {{ end }}

    <!-- Display projects grouped by year -->
    {{ range $year := sort $years "value" "desc" }}
        {{ $projectsInYear := index $yearMap (string $year) }}
        
        <div class="projects-container">
            <div class="projects-year">
                <h2>{{ $year }}</h2>
            </div>
            
            <div class="project-list">
                {{ range $projectsInYear }}
                    <div class="project-card">
                        <a href="{{ .RelPermalink }}">
                            {{ with .Params.image }}
                                <img src="{{ . }}" alt="{{ $.Title }}">
                            {{ end }}
                            <h3>{{ .Title }}</h3>
                            {{ with .Params.description }}
                                <p>{{ . }}</p>
                            {{ end }}
                            {{ with .Params.tags }}
                                <span class="project-meta">{{ delimit . ", " }}</span>
                            {{ end }}
                        </a>
                    </div>
                {{ end }}
            </div>
        </div>
    {{ end }}
</div>
    </div>
{{ end }}