{{ define "header-content" }}
<link rel="stylesheet" href="/css/working.css">
<canvas class="pixel-canvas" id="pixelCanvas"></canvas>

<div class="heading-content" id="mainHeader">
    <div id="content">
        <span class="heading-quote" id="heading">{{ .Site.Params.tagline | default "Finding my place between beauty and practicality" }}</span>
        <p>{{ .Site.Params.subtitle | default "Software Designer | Creative Technologist" }}</p>
    </div>
</div>

{{ end }}

{{ define "main" }}
    <div class="narrow-container">
        <h1>{{ .Site.Params.authorName | default "Shaurya singh" }}</h1>
        <p>{{ .Site.Params.currentRole | markdownify }}</p>
        <p>{{ .Site.Params.bio | markdownify }}</p>
    </div>
    
    <div>
        <div class="container">
            <h1>work</h1>
            <p>Collection of recent works, organised by history</p>
        </div>
        
       <div>
            {{ $projects := where .Site.RegularPages "Section" "working" }}
            {{ $projects = sort $projects "Date" "desc" }}

            {{ $yearMap := dict }}
            {{ $years := slice }}

            <!-- Group projects by year -->
            {{ range $projects }}
                {{ $year := .Params.year }}
                {{ if $year }}
                    {{ $yearStr := string $year }}
                    {{ $existing := index $yearMap $yearStr }}
                    {{ if $existing }}
                        <!-- Ensure $existing is treated as a slice -->
                        {{ $yearMap = merge $yearMap (dict $yearStr ($existing | append .)) }}
                    {{ else }}
                        {{ $yearMap = merge $yearMap (dict $yearStr (slice .)) }}
                        {{ $years = $years | append $year }}
                    {{ end }}
                {{ end }}
            {{ end }}

            <!-- Display projects grouped by year -->
            {{ range $year := sort $years "value" "desc" }}
                {{ $projectsInYear := index $yearMap (string $year) }}
                {{ $summary := index $.Site.Data.years (string $year) }}

                
                <div class="year-container">
                    <div class="projects-year">
                        <h2>{{ $year }}</h2>
                        {{ with $summary }}
                            <p>{{ . }}</p>
                        {{ end }}
                    </div>
                    
                    <div class="project-list">
                        {{ range $projectsInYear }}
                        <div class="project-card">
                        {{ if .Params.external }}
                            <a href="{{ .Params.externalurl }}" target="_blank" rel="noopener">
                            {{ else }}
                            <a href="{{ .RelPermalink }}">
                        {{ end }}

                            {{ with .Resources.GetMatch .Params.cover }}
                                <img src="{{ .RelPermalink }}" alt="" class="cover-image">
                            {{ end }}

                            <div class="project-content">
                                        <h3>{{ .Title }}</h3>
                                    {{ with .Params.description }}
                                        <p class="project-description">{{ . }}</p>
                                    {{ end }}

                                    {{ with .Params.tags }}
                                        <div class="project-tags">
                                            {{ range . }}
                                                <span class="tag-pill">{{ . }}</span>
                                            {{ end }}
                                        </div>
                                    {{ end }}
                            </div>
                        </a>
                    </div>
                {{ end }}

                    </div>
                </div>
            {{ end }}

        </div>
    </div>
{{ end }}